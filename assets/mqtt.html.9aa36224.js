import{r as o,o as r,c as l,a as n,b as a,w as p,F as c,e as s,d as u}from"./app.71086382.js";import{_ as i}from"./plugin-vue_export-helper.21dcd24c.js";const d={},k=n("h1",{id:"mqtt",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#mqtt","aria-hidden":"true"},"#"),s(" MQTT")],-1),b=n("p",null,[n("strong",null,"Integration Key:"),s(),n("code",null,"mqtt")],-1),m={class:"custom-container tip"},h=n("p",{class:"custom-container-title"},"TIP",-1),q=s("If you are looking to integrate with "),y={href:"https://www.home-assistant.io",target:"_blank",rel:"noopener noreferrer"},g=s("Home Assistant Core"),_=s(" via MQTT take a look at the "),f=s("Home Assistant integration"),T=s(" instead."),w=s("The MQTT integration will send messages with room-assistant entity update information to an "),v={href:"https://mqtt.org",target:"_blank",rel:"noopener noreferrer"},M=s("MQTT broker"),Q=s("."),x=n("h2",{id:"message-format",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#message-format","aria-hidden":"true"},"#"),s(" Message Format")],-1),A=n("p",null,[s("Entity updates are sent into unique topics for each entity, grouped by instance name and entity type. The topic format is "),n("code",null,"baseTopic/instanceName/entityType/entityId"),s(".")],-1),S=n("p",null,"Each message will have the following properties:",-1),R=n("strong",null,"entity",-1),U=s(" - This includes the whole current entity state, like you would see it in the "),V=s("API"),O=s("."),E=n("li",null,[n("strong",null,"hasAuthority"),s(" - This boolean value shows whether this update message comes from an entity that has authority over the entity. It will be "),n("code",null,"false"),s(" for distributed entity updates that are emitted from non-leader instances. You may use this to respect the room-assistant leader in your own automations, but you can of course also just pick a single instance to work off.")],-1),N=u(`<p>Optionally the message will also include the following properties:</p><ul><li><strong>diff</strong> - This is an array of changes to the previous entity state. Each array item includes a <code>path</code> to the changed property based off the entity JSON root, the <code>oldValue</code> and the <code>newValue</code>. Could be used to monitor for specific changes only. This property will not be included when instances emit an entity refresh (e.g. after re-connecting to the MQTT broker).</li></ul><details class="custom-container details"><summary>Example Message</summary><p>This message could have been posted to <code>room-assistant/entity/living-room/bluetooth-low-energy-presence-sensor/ble-some-id</code>:</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;entity&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;attributes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;distance&quot;</span><span class="token operator">:</span> <span class="token number">3.6</span><span class="token punctuation">,</span>
      <span class="token property">&quot;lastUpdatedAt&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2021-02-28T14:17:33.141Z&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ble-some-id&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Something Room Presence&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;distributed&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;stateLocked&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;distances&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;bedroom&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;lastUpdatedAt&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2021-02-28T14:17:32.605Z&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;distance&quot;</span><span class="token operator">:</span> <span class="token number">9.4</span><span class="token punctuation">,</span>
        <span class="token property">&quot;outOfRange&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;living-room&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;lastUpdatedAt&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2021-02-28T14:17:33.141Z&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;distance&quot;</span><span class="token operator">:</span> <span class="token number">3.6</span><span class="token punctuation">,</span>
        <span class="token property">&quot;outOfRange&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;timeout&quot;</span><span class="token operator">:</span> <span class="token number">180</span><span class="token punctuation">,</span>
    <span class="token property">&quot;measuredValues&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;bedroom&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;rssi&quot;</span><span class="token operator">:</span> <span class="token number">-79.81192947697268</span><span class="token punctuation">,</span>
        <span class="token property">&quot;measuredPower&quot;</span><span class="token operator">:</span> <span class="token number">-59</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;living-room&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;rssi&quot;</span><span class="token operator">:</span> <span class="token number">-70.40174705168248</span><span class="token punctuation">,</span>
        <span class="token property">&quot;measuredPower&quot;</span><span class="token operator">:</span> <span class="token number">-59</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;state&quot;</span><span class="token operator">:</span> <span class="token string">&quot;living-room&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;diff&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/measuredValues/living-room&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;oldValue&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;rssi&quot;</span><span class="token operator">:</span> <span class="token number">-73.37709762753302</span><span class="token punctuation">,</span>
        <span class="token property">&quot;measuredPower&quot;</span><span class="token operator">:</span> <span class="token number">-59</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;newValue&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;rssi&quot;</span><span class="token operator">:</span> <span class="token number">-70.40174705168248</span><span class="token punctuation">,</span>
        <span class="token property">&quot;measuredPower&quot;</span><span class="token operator">:</span> <span class="token number">-59</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/distances/living-room&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;oldValue&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;lastUpdatedAt&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2021-02-28T14:17:32.308Z&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;distance&quot;</span><span class="token operator">:</span> <span class="token number">3.8</span><span class="token punctuation">,</span>
        <span class="token property">&quot;outOfRange&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;newValue&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;lastUpdatedAt&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2021-02-28T14:17:33.141Z&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;distance&quot;</span><span class="token operator">:</span> <span class="token number">3.6</span><span class="token punctuation">,</span>
        <span class="token property">&quot;outOfRange&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;hasAuthority&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div></details><p>To get started with your automations based on these topics it is recommended to just explore the data provided in the topics using e.g. a GUI MQTT tool.</p><h2 id="settings" tabindex="-1"><a class="header-anchor" href="#settings" aria-hidden="true">#</a> Settings</h2><table><thead><tr><th>Name</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>mqttUrl</code></td><td>String</td><td><code>mqtt://localhost:1883</code></td><td>Connection string for your MQTT broker.</td></tr><tr><td><code>mqttOptions</code></td><td><a href="#mqtt-options">MQTT Options</a></td><td></td><td>Additional options for the MQTT connection.</td></tr><tr><td><code>baseTopic</code></td><td>String</td><td><code>room-assistant/entity</code></td><td>Base for the entity update topics.</td></tr><tr><td><code>qos</code></td><td>Number</td><td><code>0</code></td><td>Quality of Service level that the messages will be sent with.</td></tr><tr><td><code>retain</code></td><td>Boolean</td><td><code>false</code></td><td>Whether to mark the messages as to retain or not.</td></tr></tbody></table><h3 id="mqtt-options" tabindex="-1"><a class="header-anchor" href="#mqtt-options" aria-hidden="true">#</a> MQTT Options</h3><table><thead><tr><th>Name</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>username</code></td><td>String</td><td></td><td>Username for authentication</td></tr><tr><td><code>password</code></td><td>String</td><td></td><td>Password for authentication</td></tr><tr><td><code>rejectUnauthorized</code></td><td>Boolean</td><td><code>true</code></td><td>Whether MQTTS connections should fail for invalid certificates or not. Set this to <code>false</code> if you are using a self-signed certificate and connect via TLS.</td></tr></tbody></table><p>Some of these settings may also be configured as environment variables, using <code>RA_MQTT_MQTT_URL</code>, <code>RA_MQTT_MQTT_USERNAME</code> and <code>RA_MQTT_MQTT_PASSWORD</code>.</p><details class="custom-container details"><summary>Example Config</summary><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">global</span><span class="token punctuation">:</span>
  <span class="token key atrule">integrations</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> mqtt
<span class="token key atrule">mqtt</span><span class="token punctuation">:</span>
  <span class="token key atrule">mqttUrl</span><span class="token punctuation">:</span> mqtt<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">1883</span>
  <span class="token key atrule">mqttOptions</span><span class="token punctuation">:</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> youruser
    <span class="token key atrule">password</span><span class="token punctuation">:</span> yourpass
  <span class="token key atrule">retain</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></details>`,10);function I(P,L){const t=o("ExternalLinkIcon"),e=o("RouterLink");return r(),l(c,null,[k,b,n("div",m,[h,n("p",null,[q,n("a",y,[g,a(t)]),_,a(e,{to:"/integrations/home-assistant.html"},{default:p(()=>[f]),_:1}),T])]),n("p",null,[w,n("a",v,[M,a(t)]),Q]),x,A,S,n("ul",null,[n("li",null,[R,U,a(e,{to:"/guide/api.html"},{default:p(()=>[V]),_:1}),O]),E]),N],64)}var C=i(d,[["render",I]]);export{C as default};
